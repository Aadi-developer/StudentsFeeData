<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Check Student Fee</title>
<style>
  body { font-family: 'Arial', sans-serif; background: #f4f5fa; padding: 30px; }
  .wrap { max-width: 720px; margin: auto; background: #fff; padding: 28px; border-radius: 12px; box-shadow: 0 8px 30px rgba(18,20,40,0.06); }
  h2 { text-align: center; margin: 0 0 18px; color: #333; }
  .row { display: flex; gap: 10px; margin-bottom: 12px; }
  input[type=text] { flex: 1; padding: 12px; border: 1px solid #dde3f0; border-radius: 8px; font-size: 16px; }
  button { padding: 12px 16px; border: none; background: #4e54c8; color: #fff; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 15px; }
  button:hover { background: #3b40a0; }
  .result { margin-top: 16px; padding: 14px; border-radius: 10px; background: #f7f8ff; font-size: 16px; }
  .paid { color: green; font-weight: 600; }
  .pending { color: #d9534f; font-weight: 700; }
</style>
</head>
<body>
<div class="wrap">
  <h2>Check Student Fee Status</h2>
  <div class="row">
    <input type="text" id="nameInput" placeholder="Enter student name">
    <input type="text" id="emailInput" placeholder="Or enter email">
    <button id="checkBtn">Check</button>
  </div>
  <div id="resultArea" class="result">Enter name or email and click <strong>Check</strong>.</div>
</div>

<script>
const nameInput = document.getElementById('nameInput');
const emailInput = document.getElementById('emailInput');
const checkBtn = document.getElementById('checkBtn');
const resultArea = document.getElementById('resultArea');

async function checkFee() {
  const name = nameInput.value.trim();
  const email = emailInput.value.trim();

  if (!name && !email) {
    resultArea.innerHTML = '<span style="color:#c0392b">Please enter name or email.</span>';
    return;
  }

  resultArea.innerHTML = 'Searching...';
  const params = new URLSearchParams();
  if (name) params.append('name', name);
  if (email) params.append('email', email);

  try {
    const res = await fetch(`/check-fee?` + params.toString());
    const data = await res.json();

    if (data.status === 'not_found') {
      resultArea.innerHTML = '<strong>No student found</strong>';
      return;
    }
    if (data.status !== 'ok') {
      resultArea.innerHTML = '<strong>Error:</strong> ' + (data.message || 'Unknown');
      return;
    }

    const s = data.student;
    const feeHtml = `
      <p><strong>Name:</strong> ${s.name}</p>
      <p><strong>Class:</strong> ${s.class || '-'}</p>
      <p><strong>Email:</strong> ${s.email || '-'}</p>
      <p><strong>Phone:</strong> ${s.phone || '-'}</p>
      <p><strong>Total Fee:</strong> ₹ ${s.totalFee}</p>
      <p><strong>Paid Amount:</strong> ₹ ${s.paidAmount}</p>
      <p><strong>Status:</strong> <span class="${data.remaining === 0 ? 'paid' : 'pending'}">${data.feeStatus}</span></p>
      <p><strong>Remaining:</strong> ₹ ${data.remaining}</p>
    `;
    resultArea.innerHTML = feeHtml;
  } catch (err) {
    console.error(err);
    resultArea.innerHTML = '<span style="color:#c0392b">Server error, check console.</span>';
  }
}

checkBtn.addEventListener('click', checkFee);
[nameInput, emailInput].forEach(i => i.addEventListener('keypress', (e) => {
  if (e.key === 'Enter') checkFee();
}));
</script>
</body>
</html>
